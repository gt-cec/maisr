import pygame
import math
from env import MAISREnv
import agents
import random
import sys

env_config = {
    "gameboard size": 700,
    "num aircraft": 2,  # supports any number of aircrafts, colors are set in env.py:AIRCRAFT_COLORS
    "gameplay color": "white",
    "targets iteration": "E",
    "motion iteration": "G",
    "search pattern": "ladder",
    "verbose": False
}

pygame.init()  # init pygame
clock = pygame.time.Clock()
window = pygame.display.set_mode((env_config["gameboard size"], env_config["gameboard size"]))
env = MAISREnv(env_config, window, render=True)

state = env.reset()  # reset the environment
done = False  # flag for when the run is complete
actions = []
state, reward, done, _ = env.step(actions)  # step through the environment
test_state = env.get_state()
ship_id = 0
#print(test_state)
# Returns {'aircrafts': {100: {'position': (403.84344020662206, 40.53722306154272), 'direction': 0, 'damage': 0}, 101: {'position': (184.9562725634835, 254.70752301914735), 'direction': 0, 'damage': 0}}, 'ships': {0: {'position': (392.04340239332737, 622.6573736878876), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 1: {'position': (3.971354734890184, 189.0378185544343), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 2: {'position': (264.79713917670705, 338.59022848684526), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 3: {'position': (311.1283169150955, 412.12897331775844), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 4: {'position': (168.0375210417753, 651.1088293744878), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 5: {'position': (343.8741743737723, 60.6354579511301), 'direction': 0, 'observed': True, 'threat': 0, 'observed threat': True}, 6: {'position': (148.2141633106128, 500.3091214090032), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 7: {'position': (365.89196405113944, 422.0337735353351), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 8: {'position': (390.00494784392316, 469.2223824590034), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 9: {'position': (157.99161427934595, 24.006275577592405), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 10: {'position': (133.40174733754378, 640.262322464862), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 11: {'position': (659.6080561593812, 356.38973414857196), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 12: {'position': (116.30429417310508, 64.75255113457283), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 13: {'position': (349.98204074526603, 665.5765971038018), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 14: {'position': (302.97354534383794, 134.99993001462693), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': False}, 15: {'position': (121.26375318508649, 526.8151519301323), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 16: {'position': (457.9568183181376, 375.9679750207215), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 17: {'position': (642.8883076079422, 79.84499308840896), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 18: {'position': (259.21431266866705, 31.670259174255428), 'direction': 0, 'observed': True, 'threat': 1, 'observed threat': False}, 19: {'position': (639.3995946014822, 509.7294155243855), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 20: {'position': (120.26618138487618, 151.60762274712735), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': False}, 21: {'position': (81.17618089381133, 105.68441297103945), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 22: {'position': (425.56375784965326, 163.9681160500691), 'direction': 0, 'observed': True, 'threat': 0, 'observed threat': True}, 23: {'position': (425.0769230769231, 34.61538461538461), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': True}, 24: {'position': (84.93790153167556, 360.7855752436757), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 25: {'position': (32.02574493733433, 348.4287466216732), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 26: {'position': (240.26922836724188, 371.3973688028579), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 27: {'position': (214.79300189739533, 7.147184635526387), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 28: {'position': (130.9871924399093, 7.357647266607041), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 29: {'position': (614.5785501454048, 240.33469081107125), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 30: {'position': (116.93505840763993, 483.38962594152906), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 31: {'position': (31.790331057254615, 216.2608879889397), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': False}, 32: {'position': (297.28508374038825, 307.69670759389163), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': False}, 33: {'position': (83.34176782378701, 109.81660244436364), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 34: {'position': (152.01877560579163, 132.57433547670703), 'direction': 0, 'observed': True, 'threat': 1, 'observed threat': False}, 35: {'position': (249.69239870374548, 246.70486839641245), 'direction': 0, 'observed': True, 'threat': 1, 'observed threat': True}, 36: {'position': (424.11441833234323, 677.9364720179251), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 37: {'position': (21.97001940956084, 398.09499619316404), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 38: {'position': (426.55021317303846, 309.61925003951404), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 39: {'position': (427.05344670376473, 304.27088376269364), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 40: {'position': (459.4030729784449, 644.630833828857), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 41: {'position': (55.14034882191475, 388.1785362643055), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 42: {'position': (329.62802355449224, 446.27247006291674), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 43: {'position': (477.54966447025066, 95.2791475758824), 'direction': 0, 'observed': True, 'threat': 1, 'observed threat': True}, 44: {'position': (118.51357048919017, 568.8487953516433), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 45: {'position': (188.69159955961405, 426.0095201464819), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 46: {'position': (460.85759031387, 351.88912089867574), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 47: {'position': (644.3805576471124, 647.2695236534072), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 48: {'position': (303.8766084681876, 5.089636135495608), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': False}, 49: {'position': (8.263980448492148, 227.83759789831996), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 50: {'position': (312.28145654275164, 555.4175341488165), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 51: {'position': (97.59787424190911, 690.5279255567591), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 52: {'position': (410.0029294932148, 285.8288674483978), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 53: {'position': (680.222736163979, 44.2760155544637), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 54: {'position': (537.166609538058, 590.0699431709214), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 55: {'position': (262.6789573612511, 360.2372300173891), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': False}, 56: {'position': (604.261904059596, 88.59701185328328), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 57: {'position': (307.0010961006352, 545.8953109131023), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 58: {'position': (258.9744577394124, 170.03375768274674), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 59: {'position': (293.9997466522914, 532.0503330199895), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 60: {'position': (639.7229990755608, 219.45143423966957), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 61: {'position': (551.0565952766347, 413.75016647553014), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 62: {'position': (377.82348841000555, 576.4985783025115), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 63: {'position': (127.91688288127807, 390.9078891627256), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': False}, 64: {'position': (146.7390906173784, 574.5940577531181), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 65: {'position': (484.26628821458075, 429.99290402338914), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 66: {'position': (515.5193551276204, 320.68110549550784), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 67: {'position': (455.0213102554808, 302.10541877562036), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 68: {'position': (632.3925353106487, 223.4621089692676), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 69: {'position': (397.87456732754436, 14.525763576995399), 'direction': 0, 'observed': True, 'threat': 0, 'observed threat': True}, 70: {'position': (399.223393099733, 7.477845228811878), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': True}, 71: {'position': (635.3370692899616, 7.988625491431961), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 72: {'position': (228.46446609406726, 140.46446609406726), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': False}, 73: {'position': (443.1592990344247, 466.0711845351565), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 74: {'position': (333.051316619843, 431.7145157821617), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 75: {'position': (150.70638989024266, 531.008628134125), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 76: {'position': (195.9832232798232, 453.5907497789517), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 77: {'position': (498.0693561466692, 398.8299103515507), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 78: {'position': (210.57610780974682, 595.2549094664006), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 79: {'position': (238.14329412624377, 643.0739412259016), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 80: {'position': (62.94058234477441, 652.2314649685907), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 81: {'position': (306.73892970681885, 622.8169073568585), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 82: {'position': (356.97802693385506, 423.9704768397018), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 83: {'position': (529.4610926779951, 676.2182421447433), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 84: {'position': (496.2141623524969, 261.4476733097429), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 85: {'position': (267.6405283729181, 45.44847036589533), 'direction': 0, 'observed': True, 'threat': 0, 'observed threat': True}, 86: {'position': (362.9995891367757, 3.064097296625329), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': True}, 87: {'position': (147.79834456962487, 66.40566332781054), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 88: {'position': (619.9726529920861, 402.0206570776478), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}, 89: {'position': (349.27262130532586, 617.5463282111746), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 90: {'position': (326.4331480818242, 325.0187970590216), 'direction': 0, 'observed': True, 'threat': 3, 'observed threat': False}, 91: {'position': (32.622255493134, 530.553369015624), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 92: {'position': (86.98682908479397, 213.6373215211059), 'direction': 0, 'observed': True, 'threat': 2, 'observed threat': False}, 93: {'position': (258.81647207945804, 683.3416280542931), 'direction': 0, 'observed': False, 'threat': 2, 'observed threat': False}, 94: {'position': (388.3043857393984, 258.28209234368234), 'direction': 0, 'observed': False, 'threat': 3, 'observed threat': False}, 95: {'position': (43.88922743585321, 317.87505736486645), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 96: {'position': (502.8472800404046, 450.78476514937574), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 97: {'position': (467.3853600059739, 446.5453831307094), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}, 98: {'position': (250.17109587323122, 103.75716506874606), 'direction': 0, 'observed': True, 'threat': 1, 'observed threat': False}, 99: {'position': (449.76660359682535, 622.1545141303853), 'direction': 0, 'observed': False, 'threat': 0, 'observed threat': True}}, 'damage': 0, 'num identified ships': 36}
#print(test_state['ships'][ship_id])
# Returns {'position': (392.04340239332737, 622.6573736878876), 'direction': 0, 'observed': False, 'threat': 1, 'observed threat': False}

# Summary:
    # aircraft_id = 100,101 for 2-ship game
    # ship IDs start at 0 (e.g. for 100 ships, IDs are 0 to 99)

current_target_distances = {}  # Will be {agent_idx:distance}
aircraft_id = 100

for ship_id in test_state['ships']: # ship_id is an integer here
    if test_state['ships'][ship_id]['observed'] == False:
        print('Ship %s is unobserved' % ship_id)
        dist = math.hypot(env.agents[aircraft_id].x - env.agents[ship_id].x,env.agents[aircraft_id].y - env.agents[ship_id].y)
        print('Distance between agent %s and ship %s is %s' % (aircraft_id,ship_id,dist))
        current_target_distances[ship_id] = dist
        print('Adding dist=%s to current_target_distances for ship_id %s\n' % (dist,ship_id))
print(current_target_distances)

nearest_target_id = min(current_target_distances,key=current_target_distances.get)
target_waypoint = (env.agents[nearest_target_id].x, env.agents[nearest_target_id].y)